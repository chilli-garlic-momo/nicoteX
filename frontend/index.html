<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mallya Catcher - Secure Banking Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --secondary: #8b5cf6;
      --background: #0f172a;
      --surface: #1e293b;
      --surface-light: #334155;
      --text-primary: #f8fafc;
      --text-secondary: #cbd5e1;
      --text-muted: #94a3b8;
      --border: #475569;
      --error: #ef4444;
      --success: #10b981;
      --warning: #f59e0b;
      --glass-bg: rgba(30, 41, 59, 0.8);
      --glass-border: rgba(148, 163, 184, 0.1);
      --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.25);
      --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body, html {
      height: 100%;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, var(--background) 0%, #1e293b 50%, #334155 100%);
      color: var(--text-primary);
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* Animated background */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 25% 25%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
    }

    /* ================= UTILITIES ================= */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    .glass {
      background: var(--glass-bg);
      backdrop-filter: blur(16px);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 12px;
      border: none;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      text-decoration: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
    }

    .btn-danger {
      background: var(--error);
      color: white;
    }

    .btn-danger:hover {
      background: #dc2626;
      transform: translateY(-1px);
    }

    /* ================= LOGIN PAGE ================= */
    #login-page {
      min-height: 100vh;
      display: flex; /* Ensure login page is visible by default */
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .login-container {
      width: 100%;
      max-width: 420px;
      padding: 2.5rem;
      box-shadow: var(--shadow-lg);
    }

    .login-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .login-header h1 {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary); /* Changed to solid primary color */
      margin-bottom: 0.5rem;
    }

    .login-subtitle {
      color: var(--text-secondary);
      font-size: 0.95rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text-secondary);
    }

    .input-wrapper {
      position: relative;
    }

    .form-input {
      width: 100%;
      padding: 1rem 3rem 1rem 1rem;
      border: 2px solid var(--border);
      border-radius: 12px;
      background: var(--surface);
      color: var(--text-primary);
      font-size: 1rem;
      transition: all 0.2s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .input-icon {
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      width: 20px;
      height: 20px;
      opacity: 0.6;
    }

    .login-actions {
      margin-top: 2rem;
    }

    .login-btn {
      width: 100%;
      padding: 1rem;
      font-size: 1rem;
    }

    .login-info {
      margin-top: 1.5rem;
      text-align: center;
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    /* Error states */
    .shake {
      animation: shake 0.5s ease-in-out;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }

    /* ================= DASHBOARD ================= */
    #dashboard-page {
      display: none; /* Ensure dashboard page is hidden by default */
      min-height: 100vh;
    }

    .dashboard-layout {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 100px; /* Adjusted width for closed state */
      background: var(--glass-bg);
      backdrop-filter: blur(16px);
      border-right: 1px solid var(--glass-border);
      padding: 1.5rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: fixed; /* Fixed position to stay in place when scrolling */
      top: 0;
      left: 0;
      height: 100vh; /* Full viewport height */
      overflow: hidden;
      display: flex; /* Enable flexbox for sidebar */
      flex-direction: column; /* Stack items vertically */
      z-index: 1000; /* Ensure sidebar stays on top */
    }

    .sidebar:hover {
      width: 280px;
    }

    .sidebar.collapsed {
      width: 100px; /* Adjusted width for collapsed state */
    }

    .sidebar.collapsed:hover {
      width: 280px;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--glass-border);
    }



    .sidebar-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 0.5rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      opacity: 0;
      transform: translateX(-10px);
      white-space: nowrap;
      position: absolute;
    }

    .sidebar:hover .sidebar-title {
      opacity: 1;
      transform: translateX(0);
      position: static;
    }

    .sidebar-logo {
      width: 40px;
      height: 40px;
      opacity: 0; /* Hidden when sidebar is collapsed */
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: absolute;
    }

    .sidebar:hover .sidebar-logo {
      opacity: 0;
      position: absolute;
    }

    .sidebar-fd-logo {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
      margin-left: 0.5rem;
      opacity: 1; /* Visible when sidebar is collapsed */
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: static;
    }

    .sidebar:hover .sidebar-fd-logo {
      opacity: 0; /* Hidden when sidebar is hovered */
      position: absolute;
    }

    .sidebar-toggle {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 8px;
      transition: all 0.2s ease;
      opacity: 1; /* Visible in collapsed state */
      transform: translateX(0px); /* Position for collapsed state */
      position: static;
    }

    .sidebar:hover .sidebar-toggle {
      opacity: 0; /* Hidden when sidebar is hovered */
      transform: translateX(10px);
      position: absolute;
    }

    .sidebar-toggle:hover {
      background: var(--surface-light);
      color: var(--text-primary);
    }

    .sidebar-signout {
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--glass-border);
    }

    .sidebar-signout .btn {
      width: 100%;
      justify-content: center;
      padding: 0.75rem 1rem;
      text-align: center;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .sidebar-signout .btn .sidebar-nav-text {
      opacity: 0;
      transform: translateX(-10px);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      white-space: nowrap;
      position: absolute;
    }

    .sidebar:hover .sidebar-signout .btn .sidebar-nav-text {
      opacity: 1;
      transform: translateX(0);
      position: static;
    }

    .sidebar-nav {
      list-style: none;
      flex-grow: 1; /* Allow navigation to take available space */
    }

    .sidebar-nav-item {
      margin-bottom: 0.5rem;
    }

    .sidebar-nav-link {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      border-radius: 12px;
      color: var(--text-secondary);
      text-decoration: none;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    .sidebar-nav-link:hover {
      background: var(--surface-light);
      color: var(--text-primary);
    }

    .sidebar-nav-link.active {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
    }

    .sidebar-nav-icon {
      width: 24px;
      height: 24px;
      flex-shrink: 0;
      opacity: 1; /* Always visible in collapsed state */
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      filter: invert(1) brightness(1.5); /* Increased brightness for better visibility */
      font-size: 1.5rem; /* For emoji icons */
      display: flex; /* To center emoji */
      align-items: center;
      justify-content: center;
    }

    .sidebar:hover .sidebar-nav-icon {
      opacity: 0;
      transform: translateX(10px);
    }

    .sidebar-nav-link.active .sidebar-nav-icon {
      opacity: 1;
    }

    .sidebar-nav-text {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      white-space: nowrap;
      opacity: 0;
      transform: translateX(-10px);
      position: absolute;
    }

    .sidebar:hover .sidebar-nav-text {
      opacity: 1;
      transform: translateX(0);
      position: static;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
      margin-left: 100px; /* Account for fixed sidebar width */
      transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .main-header {
      display: flex;
      justify-content: flex-end; /* Align items to the right */
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--glass-border);
      gap: 1rem; /* Add some space between items */
    }

    .header-left {
      display: none; /* Hide header-left content */
    }

    .header-left h2 {
      font-size: 1.75rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .header-subtitle {
      color: var(--text-secondary);
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem 1rem;
      background: var(--surface);
      border-radius: 12px;
    }

    .user-avatar {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.9rem;
    }

    /* Dashboard Grid */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .dashboard-card {
      background: var(--glass-bg);
      backdrop-filter: blur(16px);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 1.5rem;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    .dashboard-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
      border-color: rgba(99, 102, 241, 0.3);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: between;
      margin-bottom: 1rem;
    }

    .card-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--primary);
    }

    .card-content {
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }

    .status-success {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
    }

    .status-warning {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning);
    }

    .status-error {
      background: rgba(239, 68, 68, 0.2);
      color: var(--error);
    }

    /* Charts placeholder */
    .chart-placeholder {
      height: 200px;
      background: var(--surface);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-muted);
      border: 2px dashed var(--border);
      max-height: 300px; /* Set a max height */
      overflow-y: auto; /* Enable vertical scrolling */
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .dashboard-layout {
        flex-direction: column;
      }

      .sidebar {
        width: 100% !important;
        padding: 1rem;
        position: relative;
      }

      .sidebar:hover {
        width: 100% !important;
      }

      .sidebar-title {
        opacity: 1 !important;
        transform: translateX(0) !important;
      }

      .sidebar-nav-text {
        opacity: 1 !important;
        transform: translateX(0) !important;
      }

      .sidebar-toggle {
        opacity: 1 !important;
        transform: translateX(0) !important;
      }

      .main-content {
        padding: 1rem;
        margin-left: 0;
      }

      .dashboard-grid {
        grid-template-columns: 1fr;
      }

      .main-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }
    }

    @media (max-width: 480px) {
      .login-container {
        padding: 1.5rem;
      }

      .login-header h1 {
        font-size: 1.5rem;
      }
    }

    /* Loading states */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid var(--glass-border);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* CSV Upload Styles */
    #csvDragDropArea {
      transition: all 0.2s ease;
    }

    #csvDragDropArea.drag-over {
      border-color: var(--primary) !important;
      background: rgba(99, 102, 241, 0.1);
    }

    #csvDataDisplay table {
      width: 100%;
      border-collapse: collapse;
      text-align: left;
    }

    #csvDataDisplay th,
    #csvDataDisplay td {
      padding: 0.75rem 0.5rem;
      border-bottom: 1px solid var(--glass-border);
    }

    #csvDataDisplay th {
      color: var(--text-secondary);
    }



  </style>
</head>
<body>
  <!-- LOGIN PAGE -->
  <div id="login-page">
    <div class="login-container glass">
      <div class="login-header">
        <h1>Mallya Catcher</h1>
        <p class="login-subtitle">Secure Banking Portal</p>
      </div>

      <form id="login-form" onsubmit="handleLogin(event)">
        <div class="form-group">
          <label for="username">Username</label>
          <div class="input-wrapper">
            <input 
              type="text" 
              id="username" 
              class="form-input" 
              placeholder="Enter your username" 
              required 
              autocomplete="username"
            />
            <img class="input-icon" src="https://img.icons8.com/ios-filled/50/ffffff/user.png" alt="User icon"/>
          </div>
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <div class="input-wrapper">
            <input 
              type="password" 
              id="password" 
              class="form-input" 
              placeholder="Enter your password" 
              required 
              autocomplete="current-password"
            />
            <img class="input-icon" src="https://img.icons8.com/ios-filled/50/ffffff/lock.png" alt="Lock icon"/>
          </div>
        </div>

        <div class="login-actions">
          <button type="submit" class="btn btn-primary login-btn">
            <span id="login-text">Sign In</span>
            <div id="login-loading" class="loading" style="display: none;"></div>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- DASHBOARD PAGE -->
  <div id="dashboard-page">
    <div class="dashboard-layout">
      <!-- Sidebar -->
      <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <h2 class="sidebar-title">Mallya<br>Catcher</h2>
          <img src="https://img.icons8.com/ios-filled/50/ffffff/bank.png" alt="Mallya Catcher Logo" class="sidebar-logo"/>
          <span class="sidebar-fd-logo">MC</span> <!-- MC Logo -->
          <button class="sidebar-toggle" onclick="toggleSidebar()" aria-label="Toggle sidebar">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M3 12h18m-9-9l9 9-9 9"/>
            </svg>
          </button>
        </div>

        <!-- Sign Out Button - Moved up for better visibility -->
        <div class="sidebar-signout">
          <button class="btn btn-danger" onclick="handleLogout()">
            <span class="sidebar-nav-text">Sign Out</span>
          </button>
        </div>

        <ul class="sidebar-nav">
          <li class="sidebar-nav-item">
            <a href="#" class="sidebar-nav-link active" data-section="dashboard">
              <div class="sidebar-nav-icon">üè†</div> <!-- Dashboard icon -->
              <span class="sidebar-nav-text">Dashboard</span>
            </a>
          </li>
          <li class="sidebar-nav-item">
            <a href="#" class="sidebar-nav-link" data-section="alerts">
              <div class="sidebar-nav-icon">üö®</div> <!-- Alerts icon -->
              <span class="sidebar-nav-text">Fraud Alerts</span>
            </a>
          </li>
          <li class="sidebar-nav-item">
            <a href="#" class="sidebar-nav-link" data-section="transactions">
              <div class="sidebar-nav-icon">üí∏</div> <!-- Transactions icon -->
              <span class="sidebar-nav-text">Transactions</span>
            </a>
          </li>
          <li class="sidebar-nav-item">
            <a href="#" class="sidebar-nav-link" data-section="scenarios">
              <div class="sidebar-nav-icon">üî¨</div> <!-- Scenarios icon -->
              <span class="sidebar-nav-text">Scenarios</span>
            </a>
          </li>
        </ul>
      </nav>

      <!-- Main Content -->
      <main class="main-content">
        <header class="main-header">
          <div class="header-left">
            <h2 id="page-title">Dashboard Overview</h2>
            <p class="header-subtitle" id="page-subtitle">Monitor your banking security in real-time</p>
          </div>
          <div class="header-actions">
            <div class="user-info">
              <div class="user-avatar">U</div>
              <span id="welcome-message">Welcome back</span>
            </div>
            
          </div>
        </header>

        <!-- Dashboard Content -->
        <div id="dashboard-content" class="page-content">
          <div class="dashboard-grid">
            <div class="dashboard-card">
              <div class="card-header">
                <h3 class="card-title">CSV Data Upload</h3>
              </div>
              <div class="card-content">
                <input type="file" id="csvFileInput" accept=".csv" style="display: none;"/>
                <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                  <label for="csvFileInput" class="btn btn-primary" style="flex: 1; text-align: center;">
                    Choose CSV File
                  </label>
                  <button type="button" class="btn" style="background: var(--surface); color: var(--text-primary); border: 1px solid var(--border);" onclick="app.downloadTemplate()">
                    üìã Template
                  </button>
                </div>
                <div id="csvDragDropArea" style="border: 2px dashed var(--border); border-radius: 12px; padding: 2rem; text-align: center; color: var(--text-muted);">
                  Drag & Drop CSV File Here
                </div>
                <p id="fileNameDisplay" style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-secondary);"></p>
                <div class="chart-placeholder" style="margin-top: 1rem;">
                  üìä Uploaded CSV data will be displayed here
                </div>
              </div>
            </div>

            <div class="dashboard-card">
              <div class="card-header">
                <h3 class="card-title">Recent Transactions</h3>
                <span class="status-indicator status-success">‚óè  Active</span>
              </div>
              <div class="card-content" id="transaction-stream">
                <p>Monitoring recent transaction feed...</p>
                <p style="margin-top: 0.5rem; color: var(--text-muted); font-size: 0.9rem;">
                  Last update: <span id="last-update">Just now</span>
                </p>
              </div>
            </div>

            <div class="dashboard-card">
              <div class="card-header">
                <h3 class="card-title">Fraud Alerts</h3>
                <span class="status-indicator status-success" id="alert-status">‚óè  Clear</span>
              </div>
              <div class="card-content" id="alert-list">
                <p>No suspicious activity detected</p>
                <p style="margin-top: 0.5rem; color: var(--text-muted); font-size: 0.9rem;">
                  System status: All monitors active
                </p>
              </div>
            </div>

            <div class="dashboard-card">
              <div class="card-header">
                <h3 class="card-title">Risk Analysis</h3>
                <span class="status-indicator status-warning">‚óè  Monitoring</span>
              </div>
              <div class="card-content" id="explanation-box">
                <p>Advanced fraud detection algorithms are continuously analyzing transaction patterns to identify potential threats.</p>
              </div>
            </div>

            <div class="dashboard-card">
              <div class="card-header">
                <h3 class="card-title">Transaction Statistics</h3>
              </div>
              <div class="card-content" id="transaction-statistics">
                <div class="chart-placeholder">
                  üìä Interactive charts will be displayed here
                </div>
              </div>
            </div>

            <div class="dashboard-card">
              <div class="card-header">
                <h3 class="card-title">Synthetic Scenarios</h3>
              </div>
              <div class="card-content">
                <select class="form-input" id="scenario-filter" style="margin-bottom: 1rem;">
                  <option value="normal">Normal Operations</option>
                  <option value="fraud-type-1">Card Fraud Simulation</option>
                  <option value="fraud-type-2">Identity Theft Simulation</option>
                  <option value="fraud-type-3">Account Takeover Simulation</option>
                </select>
                <div id="synthetic-details">
                  <p>Select a scenario to view detailed fraud simulation parameters and expected system responses.</p>
                </div>
              </div>
            </div>

            <div class="dashboard-card">
              <div class="card-header">
                <h3 class="card-title">System Health</h3>
                <span class="status-indicator status-success">‚óè  Optimal</span>
              </div>
              <div class="card-content">
                <p>All fraud detection systems are operating within normal parameters.</p>
                <div style="margin-top: 1rem; display: flex; gap: 1rem; font-size: 0.9rem;">
                  <div>CPU: <strong>23%</strong></div>
                  <div>Memory: <strong>67%</strong></div>
                  <div>Network: <strong>Normal</strong></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Alerts Content -->
        <div id="alerts-content" class="page-content" style="display: none;">
          <div class="dashboard-grid">
            <div class="dashboard-card">
              <div class="card-header">
                <h3 class="card-title">Active Alerts</h3>
                <span class="status-indicator status-success">‚óè  0 Active</span>
              </div>
              <div class="card-content">
                <div class="alert-item" style="padding: 1rem; background: var(--surface); border-radius: 8px; margin-bottom: 1rem;">
                  <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                    <span style="color: var(--success);">‚úÖ</span>
                    <strong>System Status: Normal</strong>
                  </div>
                  <p style="color: var(--text-muted); font-size: 0.9rem;">All fraud detection systems are operating normally. No suspicious activities detected in the last 24 hours.</p>
                </div>
              </div>
            </div>

            <div class="dashboard-card">
              <div class="card-header">
                <h3 class="card-title">Alert History</h3>
              </div>
              <div class="card-content">
                <div class="alert-history">
                  <div class="history-item" style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid var(--glass-border);">
                    <div>
                      <div style="font-weight: 600;">Unusual Login Pattern</div>
                      <div style="color: var(--text-muted); font-size: 0.9rem;">Multiple login attempts from new device</div>
                    </div>
                    <div style="text-align: right;">
                      <div style="color: var(--warning);">Resolved</div>
                      <div style="color: var(--text-muted); font-size: 0.85rem;">2 days ago</div>
                    </div>
                  </div>
                  <div class="history-item" style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid var(--glass-border);">
                    <div>
                      <div style="font-weight: 600;">High-Value Transaction</div>
                      <div style="color: var(--text-muted); font-size: 0.9rem;">Transaction above normal spending pattern</div>
                    </div>
                    <div style="text-align: right;">
                      <div style="color: var(--success);">Verified</div>
                      <div style="color: var(--text-muted); font-size: 0.85rem;">5 days ago</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="dashboard-card">
              <div class="card-header">
                <h3 class="card-title">Alert Settings</h3>
              </div>
              <div class="card-content">
                <div style="margin-bottom: 1rem;">
                  <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                    <input type="checkbox" checked style="accent-color: var(--primary);">
                    Email notifications for high-risk transactions
                  </label>
                  <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                    <input type="checkbox" checked style="accent-color: var(--primary);">
                    SMS alerts for login from new devices
                  </label>
                  <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                    <input type="checkbox" style="accent-color: var(--primary);">
                    Push notifications for all transactions
                  </label>
                </div>
                <button class="btn btn-primary" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
                  Update Settings
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Transactions Content -->
        <div id="transactions-content" class="page-content" style="display: none;">
          <div class="dashboard-grid">
            <div class="dashboard-card" style="grid-column: 1 / -1;">
              <div class="card-header">
                <h3 class="card-title">Transaction History</h3>
                <div style="display: flex; gap: 1rem;">
                  <select class="form-input" style="width: auto; padding: 0.5rem;">
                    <option>Last 30 days</option>
                    <option>Last 7 days</option>
                    <option>Last 90 days</option>
                  </select>
                  <input type="text" class="form-input" placeholder="Search transactions..." style="width: 200px; padding: 0.5rem;">
                </div>
              </div>
              <div class="card-content">
                <div class="transaction-table" style="overflow-x: auto;">
                  <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                      <tr style="border-bottom: 1px solid var(--glass-border);">
                        <th style="text-align: left; padding: 1rem 0.5rem; color: var(--text-secondary);">Date</th>
                        <th style="text-align: left; padding: 1rem 0.5rem; color: var(--text-secondary);">Description</th>
                        <th style="text-align: left; padding: 1rem 0.5rem; color: var(--text-secondary);">Amount</th>
                        <th style="text-align: left; padding: 1rem 0.5rem; color: var(--text-secondary);">Status</th>
                        <th style="text-align: left; padding: 1rem 0.5rem; color: var(--text-secondary);">Risk Score</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr style="border-bottom: 1px solid var(--glass-border);">
                        <td style="padding: 1rem 0.5rem;">2024-08-23</td>
                        <td style="padding: 1rem 0.5rem;">Online Purchase - Amazon</td>
                        <td style="padding: 1rem 0.5rem; color: var(--error);">-$156.99</td>
                        <td style="padding: 1rem 0.5rem;"><span class="status-indicator status-success">Verified</span></td>
                        <td style="padding: 1rem 0.5rem;"><span style="color: var(--success);">Low</span></td>
                      </tr>
                      <tr style="border-bottom: 1px solid var(--glass-border);">
                        <td style="padding: 1rem 0.5rem;">2024-08-22</td>
                        <td style="padding: 1rem 0.5rem;">ATM Withdrawal</td>
                        <td style="padding: 1rem 0.5rem; color: var(--error);">-$200.00</td>
                        <td style="padding: 1rem 0.5rem;"><span class="status-indicator status-success">Verified</span></td>
                        <td style="padding: 1rem 0.5rem;"><span style="color: var(--success);">Low</span></td>
                      </tr>
                      <tr style="border-bottom: 1px solid var(--glass-border);">
                        <td style="padding: 1rem 0.5rem;">2024-08-22</td>
                        <td style="padding: 1rem 0.5rem;">Salary Deposit</td>
                        <td style="padding: 1rem 0.5rem; color: var(--success);">+$3,500.00</td>
                        <td style="padding: 1rem 0.5rem;"><span class="status-indicator status-success">Cleared</span></td>
                        <td style="padding: 1rem 0.5rem;"><span style="color: var(--success);">None</span></td>
                      </tr>
                      <tr style="border-bottom: 1px solid var(--glass-border);">
                        <td style="padding: 1rem 0.5rem;">2024-08-21</td>
                        <td style="padding: 1rem 0.5rem;">Gas Station - Shell</td>
                        <td style="padding: 1rem 0.5rem; color: var(--error);">-$45.67</td>
                        <td style="padding: 1rem 0.5rem;"><span class="status-indicator status-success">Verified</span></td>
                        <td style="padding: 1rem 0.5rem;"><span style="color: var(--success);">Low</span></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <div class="dashboard-card">
              <div class="card-header">
                <h3 class="card-title">Monthly Summary</h3>
              </div>
              <div class="card-content">
                <div style="margin-bottom: 1rem;">
                  <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>Total Income:</span>
                    <span style="color: var(--success); font-weight: 600;">+$7,250.00</span>
                  </div>
                  <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>Total Expenses:</span>
                    <span style="color: var(--error); font-weight: 600;">-$2,847.32</span>
                  </div>
                  <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; padding-top: 0.5rem; border-top: 1px solid var(--glass-border);">
                    <span style="font-weight: 600;">Net Change:</span>
                    <span style="color: var(--success); font-weight: 600;">+$4,402.68</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="dashboard-card">
              <div class="card-header">
                <h3 class="card-title">Transaction Categories</h3>
              </div>
              <div class="card-content">
                <div class="category-item" style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">
                  <span>Shopping</span>
                  <span style="font-weight: 600;">$856.23</span>
                </div>
                <div class="category-item" style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">
                  <span>Groceries</span>
                  <span style="font-weight: 600;">$432.11</span>
                </div>
                <div class="category-item" style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">
                  <span>Gas & Transportation</span>
                  <span style="font-weight: 600;">$267.89</span>
                </div>
                <div class="category-item" style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">
                  <span>Restaurants</span>
                  <span style="font-weight: 600;">$198.45</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Scenarios Content -->
        <div id="scenarios-content" class="page-content" style="display: none;">
          <div class="dashboard-grid">
            <div class="dashboard-card">
              <div class="card-header">
                <h3 class="card-title">Scenario Generator</h3>
              </div>
              <div class="card-content">
                <div style="margin-bottom: 1rem;">
                  <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Fraud Type:</label>
                  <select class="form-input" id="fraud-type-select">
                    <option value="card-fraud">Card Fraud</option>
                    <option value="identity-theft">Identity Theft</option>
                    <option value="account-takeover">Account Takeover</option>
                    <option value="phishing">Phishing Attack</option>
                  </select>
                </div>
                <div style="margin-bottom: 1rem;">
                  <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Severity Level:</label>
                  <select class="form-input">
                    <option value="low">Low Risk</option>
                    <option value="medium">Medium Risk</option>
                    <option value="high">High Risk</option>
                  </select>
                </div>
                <button class="btn btn-primary">Generate Scenario</button>
              </div>
            </div>

            <div class="dashboard-card">
              <div class="card-header">
                <h3 class="card-title">Active Scenarios</h3>
              </div>
              <div class="card-content">
                <div class="scenario-item" style="padding: 1rem; background: var(--surface); border-radius: 8px; margin-bottom: 1rem;">
                  <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <strong>Card Fraud Simulation #1</strong>
                    <span class="status-indicator status-warning">‚óè  Running</span>
                  </div>
                  <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 0.5rem;">Simulating unusual spending patterns across multiple merchant categories.</p>
                  <div style="display: flex; gap: 1rem; font-size: 0.85rem;">
                    <span>Duration: 15 min</span>
                    <span>Transactions: 23</span>
                    <span>Risk Score: 8.2/10</span>
                  </div>
                </div>
                
                <div class="scenario-item" style="padding: 1rem; background: var(--surface); border-radius: 8px; margin-bottom: 1rem;">
                  <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <strong>Identity Theft Test #3</strong>
                    <span class="status-indicator status-success">‚óè  Completed</span>
                  </div>
                  <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 0.5rem;">Profile modification attempts and suspicious authentication patterns.</p>
                  <div style="display: flex; gap: 1rem; font-size: 0.85rem;">
                    <span>Duration: 30 min</span>
                    <span>Attempts: 47</span>
                    <span>Detection Rate: 96%</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="dashboard-card">
              <div class="card-header">
                <h3 class="card-title">Scenario Results</h3>
              </div>
              <div class="card-content">
                <div class="chart-placeholder" style="height: 150px;">
                  üìà Scenario performance metrics will be displayed here
                </div>
                <div style="margin-top: 1rem;">
                  <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>Detection Accuracy:</span>
                    <span style="color: var(--success); font-weight: 600;">94.2%</span>
                  </div>
                  <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>False Positives:</span>
                    <span style="color: var(--warning); font-weight: 600;">2.1%</span>
                  </div>
                  <div style="display: flex; justify-content: space-between;">
                    <span>Response Time:</span>
                    <span style="color: var(--success); font-weight: 600;">1.3s avg</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script>
    // Application State
    const app = {
  isLoggedIn: false,
  currentUser: null,
  apiBaseUrl: 'http://localhost:8000', // Backend API URL
  
  init() {
    this.checkAuthStatus();
    this.setupEventListeners();
    this.updateTimestamp();
    this.checkBackendHealth();
  },

  checkAuthStatus() {
    const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
    if (isLoggedIn) {
      this.showDashboard();
    } else {
      this.showLogin();
    }
  },

  setupEventListeners() {
    // Navigation
    document.querySelectorAll('.sidebar-nav-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const section = link.getAttribute('data-section');
        this.showSection(section);
        this.setActiveNavItem(link);
      });
    });

    // Scenario filter
    const scenarioFilter = document.getElementById('scenario-filter');
    if (scenarioFilter) {
      scenarioFilter.addEventListener('change', (e) => this.updateScenarioDetails());
      // or: scenarioFilter.addEventListener('change', this.updateScenarioDetails.bind(this));
    }

    // CSV File Input
    const csvFileInput = document.getElementById('csvFileInput');
    const csvDragDropArea = document.getElementById('csvDragDropArea');

    if (csvFileInput && csvDragDropArea) {
      csvFileInput.addEventListener('change', (e) => this.handleCsvFile(e.target.files[0]));
      csvDragDropArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        csvDragDropArea.style.borderColor = 'var(--primary)';
      });
      csvDragDropArea.addEventListener('dragleave', (e) => {
        e.preventDefault();
        csvDragDropArea.style.borderColor = 'var(--border)';
      });
      csvDragDropArea.addEventListener('drop', (e) => {
        e.preventDefault();
        csvDragDropArea.style.borderColor = 'var(--border)';
        this.handleCsvFile(e.dataTransfer.files);
      });
    }
  },

  showSection(sectionName) {
    // Hide all content sections
    document.querySelectorAll('.page-content').forEach(section => {
      section.style.display = 'none';
    });

    // Show selected section
    const targetSection = document.getElementById(`${sectionName}-content`);
    if (targetSection) {
      targetSection.style.display = 'block';
    }

    // Update page title and subtitle
    const pageTitle = document.getElementById('page-title');
    const pageSubtitle = document.getElementById('page-subtitle');

    const sectionConfig = {
      dashboard: {
        title: 'Dashboard Overview',
        subtitle: 'Monitor your banking security in real-time'
      },
      alerts: {
        title: 'Fraud Alerts',
        subtitle: 'Manage and review security alerts and notifications'
      },
      transactions: {
        title: 'Transaction History',
        subtitle: 'View and analyze your transaction patterns'
      },
      scenarios: {
        title: 'Synthetic Scenarios',
        subtitle: 'Test fraud detection with simulated scenarios'
      }
    };

    const config = sectionConfig[sectionName] || sectionConfig.dashboard;
    pageTitle.textContent = config.title;
    pageSubtitle.textContent = config.subtitle;
  },

  showLogin() {
    document.getElementById('login-page').style.display = 'flex';
    document.getElementById('dashboard-page').style.display = 'none';
    document.getElementById('username').focus();
  },

  showDashboard() {
    document.getElementById('login-page').style.display = 'none';
    document.getElementById('dashboard-page').style.display = 'block';
    this.isLoggedIn = true;
    this.showSection('dashboard'); // Show default section
    this.startLiveUpdates();
    this.updateWelcomeMessage(); // New: Update welcome message
  },

  setActiveNavItem(activeLink) {
    document.querySelectorAll('.sidebar-nav-link').forEach(link => {
      link.classList.remove('active');
    });
    activeLink.classList.add('active');
  },

  updateWelcomeMessage() { // New method
    const username = localStorage.getItem('username') || 'User';
    document.getElementById('welcome-message').textContent = `Hello, ${username}!`;
    document.querySelector('.user-avatar').textContent = username.charAt(0).toUpperCase();
  },

  updateScenarioDetails() {
    const scenario = document.getElementById('scenario-filter').value;
    const detailsDiv = document.getElementById('synthetic-details');
    
    const scenarios = {
      'normal': 'Normal operations with standard transaction patterns and expected user behavior.',
      'fraud-type-1': 'Card fraud simulation: Unusual spending patterns, geographic anomalies, and merchant category deviations.',
      'fraud-type-2': 'Identity theft simulation: Multiple account access attempts, profile changes, and suspicious authentication patterns.',
      'fraud-type-3': 'Account takeover simulation: Login from new devices, password changes, and unauthorized transaction attempts.'
    };

    detailsDiv.innerHTML = `<p>${scenarios[scenario]}</p>`;
  },

  updateTimestamp() {
    const updateElement = document.getElementById('last-update');
    if (updateElement) {
      const now = new Date();
      updateElement.textContent = now.toLocaleTimeString();
    }
  },

  startLiveUpdates() {
    // Update timestamp every 30 seconds
    setInterval(() => {
      this.updateTimestamp();
    }, 30000);
  },

  async handleCsvFile(file) {
    const fileNameDisplay = document.getElementById('fileNameDisplay');
    const csvDataDisplay = document.querySelector('#csvFileInput + label + div + p + .chart-placeholder');

    if (!file) {
      fileNameDisplay.textContent = 'No file selected.';
      csvDataDisplay.innerHTML = 'üìä Uploaded CSV data will be displayed here';
      return;
    }

    fileNameDisplay.textContent = `Selected file: ${file.name}`;
    
    // Show loading state
    csvDataDisplay.innerHTML = '<div style="text-align: center; padding: 2rem;"><div class="loading" style="margin: 0 auto 1rem;"></div><p>Processing CSV file...</p></div>';

    try {
      // Create FormData for file upload
      const formData = new FormData();
      formData.append('file', file);

      // Send to backend API
      const response = await fetch(`${this.apiBaseUrl}/transactions/batch`, {
        method: 'POST',
        body: formData
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.detail || 'Failed to process CSV file');
      }

      const result = await response.json();
      
      // Display results in CSV upload area
      this.displayFraudAnalysisResults(result, file);
      
      // Update all dashboard sections with ML results
      this.updateFraudAlerts(result);
      this.updateTransactionStats(result);
      this.updateRiskAnalysis(result);
      this.updateRecentTransactions(result);
      this.updateTransactionStatistics(result);
      
    } catch (error) {
      console.error('Error processing CSV:', error);
      csvDataDisplay.innerHTML = `<div style="color: var(--error); text-align: center; padding: 2rem;">
        <p>‚ùå Error processing file: ${error.message}</p>
        <p style="font-size: 0.9rem; margin-top: 1rem;">Please ensure your CSV has the required columns: user_id, amount, location, device, merchant, timestamp</p>
      </div>`;
    }
  },

  displayFraudAnalysisResults(result, file) {
    const csvDataDisplay = document.querySelector('#csvFileInput + label + div + p + .chart-placeholder');
    
    let html = '<div style="overflow-x: auto;">';
    
    // Summary statistics
    html += `<div style="margin-bottom: 1.5rem; padding: 1rem; background: var(--surface); border-radius: 8px;">
      <h4 style="margin-bottom: 1rem; color: var(--primary);">üìä Analysis Summary</h4>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
        <div style="text-align: center;">
          <div style="font-size: 1.5rem; font-weight: 600; color: var(--text-primary);">${result.total_transactions}</div>
          <div style="font-size: 0.9rem; color: var(--text-secondary);">Total Transactions</div>
        </div>
        <div style="text-align: center;">
          <div style="font-size: 1.5rem; font-weight: 600; color: var(--error);">${result.fraudulent_transactions}</div>
          <div style="font-size: 0.9rem; color: var(--text-secondary);">Fraudulent Detected</div>
        </div>
        <div style="text-align: center;">
          <div style="font-size: 1.5rem; font-weight: 600; color: var(--success);">${result.total_transactions - result.fraudulent_transactions}</div>
          <div style="font-size: 0.9rem; color: var(--text-secondary);">Legitimate</div>
        </div>
        <div style="text-align: center;">
          <div style="font-size: 1.5rem; font-weight: 600; color: var(--warning);">${((result.fraudulent_transactions / result.total_transactions) * 100).toFixed(1)}%</div>
          <div style="font-size: 0.9rem; color: var(--text-secondary);">Fraud Rate</div>
        </div>
      </div>
    </div>`;
    
    // Fraudulent transactions table
    const fraudulentTxns = result.results.filter(r => r.alert_flag);
    if (fraudulentTxns.length > 0) {
      html += `<div style="margin-bottom: 1.5rem;">
        <h4 style="margin-bottom: 1rem; color: var(--error);">üö® Fraudulent Transactions Detected</h4>
        <table style="width: 100%; border-collapse: collapse; text-align: left; background: var(--surface); border-radius: 8px; overflow: hidden;">
          <thead>
            <tr style="background: var(--surface-light);">
              <th style="padding: 0.75rem; color: var(--text-secondary);">Transaction ID</th>
              <th style="padding: 0.75rem; color: var(--text-secondary);">Anomaly Score</th>
              <th style="padding: 0.75rem; color: var(--text-secondary);">Explanation</th>
            </tr>
          </thead>
          <tbody>`;
      
      fraudulentTxns.forEach(txn => {
        html += `<tr style="border-bottom: 1px solid var(--glass-border);">
          <td style="padding: 0.75rem; font-weight: 600;">${txn.txn_id}</td>
          <td style="padding: 0.75rem;">
            <span style="color: var(--error); font-weight: 600;">${txn.anomaly_score.toFixed(3)}</span>
          </td>
          <td style="padding: 0.75rem; font-size: 0.9rem; color: var(--text-secondary);">${txn.explanation}</td>
        </tr>`;
      });
      
      html += '</tbody></table></div>';
    }
    
    // All transactions table (collapsible)
    html += `<div>
      <details style="margin-bottom: 1rem;">
        <summary style="cursor: pointer; padding: 0.5rem; background: var(--surface); border-radius: 8px; margin-bottom: 0.5rem;">
          <span style="color: var(--primary); font-weight: 600;">üìã View All Transactions (${result.results.length})</span>
        </summary>
        <table style="width: 100%; border-collapse: collapse; text-align: left; background: var(--surface); border-radius: 8px; overflow: hidden;">
          <thead>
            <tr style="background: var(--surface-light);">
              <th style="padding: 0.75rem; color: var(--text-secondary);">Transaction ID</th>
              <th style="padding: 0.75rem; color: var(--text-secondary);">Anomaly Score</th>
              <th style="padding: 0.75rem; color: var(--text-secondary);">Status</th>
              <th style="padding: 0.75rem; color: var(--text-secondary);">Explanation</th>
            </tr>
          </thead>
          <tbody>`;
      
      result.results.forEach(txn => {
        const statusColor = txn.alert_flag ? 'var(--error)' : 'var(--success)';
        const statusText = txn.alert_flag ? 'üö® Fraudulent' : '‚úÖ Legitimate';
        
        html += `<tr style="border-bottom: 1px solid var(--glass-border);">
          <td style="padding: 0.75rem; font-weight: 600;">${txn.txn_id}</td>
          <td style="padding: 0.75rem;">
            <span style="color: ${statusColor}; font-weight: 600;">${txn.anomaly_score.toFixed(3)}</span>
          </td>
          <td style="padding: 0.75rem;">
            <span style="color: ${statusColor}; font-weight: 600;">${statusText}</span>
          </td>
          <td style="padding: 0.75rem; font-size: 0.9rem; color: var(--text-secondary);">${txn.explanation}</td>
        </tr>`;
      });
      
      html += '</tbody></table></details></div>';
    
    html += '</div>';
    csvDataDisplay.innerHTML = html;
  },

  updateFraudAlerts(result) {
    const alertList = document.getElementById('alert-list');
    const alertStatus = document.getElementById('alert-status');
    const fraudulentCount = result.fraudulent_transactions;
    
    // Update alert status indicator
    if (fraudulentCount > 0) {
      alertStatus.textContent = `‚óè  ${fraudulentCount} Alert${fraudulentCount > 1 ? 's' : ''}`;
      alertStatus.className = 'status-indicator status-error';
    } else {
      alertStatus.textContent = '‚óè  Clear';
      alertStatus.className = 'status-indicator status-success';
    }
    
    if (fraudulentCount > 0) {
      const fraudulentTxns = result.results.filter(r => r.alert_flag);
      let html = `<div style="margin-bottom: 1rem;">
        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
          <span style="color: var(--error);">üö®</span>
          <strong>${fraudulentCount} Fraudulent Transaction${fraudulentCount > 1 ? 's' : ''} Detected</strong>
        </div>`;
      
      fraudulentTxns.slice(0, 3).forEach(txn => {
        html += `<div style="padding: 0.75rem; background: var(--surface); border-radius: 8px; margin-bottom: 0.5rem; border-left: 4px solid var(--error);">
          <div style="font-weight: 600; margin-bottom: 0.25rem;">Transaction ID: ${txn.txn_id}</div>
          <div style="font-size: 0.9rem; color: var(--text-secondary);">Risk Score: ${txn.anomaly_score.toFixed(3)}</div>
          <div style="font-size: 0.85rem; color: var(--text-muted); margin-top: 0.25rem;">${txn.explanation}</div>
        </div>`;
      });
      
      if (fraudulentCount > 3) {
        html += `<div style="font-size: 0.9rem; color: var(--text-muted);">... and ${fraudulentCount - 3} more</div>`;
      }
      
      html += '</div>';
      alertList.innerHTML = html;
    } else {
      alertList.innerHTML = `<p>‚úÖ No suspicious activity detected</p>
        <p style="margin-top: 0.5rem; color: var(--text-muted); font-size: 0.9rem;">
          All ${result.total_transactions} transactions analyzed successfully
        </p>`;
    }
  },

  updateTransactionStats(result) {
    const transactionStream = document.getElementById('transaction-stream');
    const legitimateCount = result.total_transactions - result.fraudulent_transactions;
    
    // Calculate additional statistics
    const avgScore = result.results.reduce((sum, txn) => sum + txn.anomaly_score, 0) / result.total_transactions;
    const highRiskCount = result.results.filter(txn => txn.anomaly_score > 0.5).length;
    const mediumRiskCount = result.results.filter(txn => txn.anomaly_score > 0.25 && txn.anomaly_score <= 0.5).length;
    
    transactionStream.innerHTML = `
      <div style="margin-bottom: 1rem;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
          <span>Total Processed:</span>
          <span style="font-weight: 600;">${result.total_transactions} transactions</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
          <span>‚úÖ Legitimate:</span>
          <span style="color: var(--success); font-weight: 600;">${legitimateCount}</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
          <span>üö® Fraudulent:</span>
          <span style="color: var(--error); font-weight: 600;">${result.fraudulent_transactions}</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
          <span>‚ö†Ô∏è High Risk:</span>
          <span style="color: var(--warning); font-weight: 600;">${highRiskCount}</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
          <span>üìä Avg Risk Score:</span>
          <span style="font-weight: 600;">${avgScore.toFixed(3)}</span>
        </div>
      </div>
      <p style="margin-top: 0.5rem; color: var(--text-muted); font-size: 0.9rem;">
        Last update: <span id="last-update">Just now</span>
      </p>
    `;
  },

  updateRecentTransactions(result) {
    const transactionStream = document.getElementById('transaction-stream');
    
    // Get the most recent transactions (last 5)
    const recentTxns = result.results.slice(-5).reverse();
    
    let html = `<div style="margin-bottom: 1rem;">`;
    
    recentTxns.forEach(txn => {
      const statusIcon = txn.alert_flag ? 'üö®' : '‚úÖ';
      const statusColor = txn.alert_flag ? 'var(--error)' : 'var(--success)';
      const riskLevel = txn.anomaly_score > 0.5 ? 'High' : txn.anomaly_score > 0.25 ? 'Medium' : 'Low';
      
      html += `<div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid var(--glass-border);">
        <div style="flex: 1;">
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <span style="color: ${statusColor};">${statusIcon}</span>
            <span style="font-weight: 600;">TXN-${txn.txn_id}</span>
          </div>
          <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.25rem;">
            Risk: ${riskLevel} (${txn.anomaly_score.toFixed(3)})
          </div>
        </div>
        <div style="text-align: right;">
          <div style="font-size: 0.9rem; color: ${statusColor}; font-weight: 600;">
            ${txn.alert_flag ? 'Fraudulent' : 'Legitimate'}
          </div>
        </div>
      </div>`;
    });
    
    html += `</div>
      <p style="margin-top: 0.5rem; color: var(--text-muted); font-size: 0.9rem;">
        Last update: <span id="last-update">Just now</span>
      </p>`;
    
    transactionStream.innerHTML = html;
  },

  updateTransactionStatistics(result) {
    const transactionStats = document.getElementById('transaction-statistics');
    const totalCount = result.total_transactions;
    const fraudulentCount = result.fraudulent_transactions;
    const legitimateCount = totalCount - fraudulentCount;
    
    // Calculate risk distribution
    const highRisk = result.results.filter(txn => txn.anomaly_score > 0.5).length;
    const mediumRisk = result.results.filter(txn => txn.anomaly_score > 0.25 && txn.anomaly_score <= 0.5).length;
    const lowRisk = result.results.filter(txn => txn.anomaly_score <= 0.25).length;
    
    // Calculate percentages for visual bars
    const highRiskPercent = (highRisk / totalCount) * 100;
    const mediumRiskPercent = (mediumRisk / totalCount) * 100;
    const lowRiskPercent = (lowRisk / totalCount) * 100;
    
    let html = `<div style="margin-bottom: 1.5rem;">
      <h4 style="margin-bottom: 1rem; color: var(--primary);">üìä Risk Distribution</h4>
      
      <div style="margin-bottom: 1rem;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
          <span>High Risk (Score > 0.5)</span>
          <span style="color: var(--error); font-weight: 600;">${highRisk} (${highRiskPercent.toFixed(1)}%)</span>
        </div>
        <div style="background: var(--surface); border-radius: 4px; height: 8px; overflow: hidden;">
          <div style="background: var(--error); height: 100%; width: ${highRiskPercent}%; transition: width 0.3s ease;"></div>
        </div>
      </div>
      
      <div style="margin-bottom: 1rem;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
          <span>Medium Risk (0.25-0.5)</span>
          <span style="color: var(--warning); font-weight: 600;">${mediumRisk} (${mediumRiskPercent.toFixed(1)}%)</span>
        </div>
        <div style="background: var(--surface); border-radius: 4px; height: 8px; overflow: hidden;">
          <div style="background: var(--warning); height: 100%; width: ${mediumRiskPercent}%; transition: width 0.3s ease;"></div>
        </div>
      </div>
      
      <div style="margin-bottom: 1rem;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
          <span>Low Risk (‚â§ 0.25)</span>
          <span style="color: var(--success); font-weight: 600;">${lowRisk} (${lowRiskPercent.toFixed(1)}%)</span>
        </div>
        <div style="background: var(--surface); border-radius: 4px; height: 8px; overflow: hidden;">
          <div style="background: var(--success); height: 100%; width: ${lowRiskPercent}%; transition: width 0.3s ease;"></div>
        </div>
      </div>
    </div>
    
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
      <div style="text-align: center; padding: 1rem; background: var(--surface); border-radius: 8px;">
        <div style="font-size: 1.5rem; font-weight: 600; color: var(--success);">${legitimateCount}</div>
        <div style="font-size: 0.9rem; color: var(--text-secondary);">Legitimate</div>
      </div>
      <div style="text-align: center; padding: 1rem; background: var(--surface); border-radius: 8px;">
        <div style="font-size: 1.5rem; font-weight: 600; color: var(--error);">${fraudulentCount}</div>
        <div style="font-size: 0.9rem; color: var(--text-secondary);">Fraudulent</div>
      </div>
    </div>`;
    
    transactionStats.innerHTML = html;
  },

  updateRiskAnalysis(result) {
    const explanationBox = document.getElementById('explanation-box');
    const fraudulentCount = result.fraudulent_transactions;
    const totalCount = result.total_transactions;
    const fraudRate = ((fraudulentCount / totalCount) * 100).toFixed(1);
    
    // Get unique risk factors from explanations
    const riskFactors = new Set();
    result.results.forEach(txn => {
      if (txn.explanation) {
        const factors = txn.explanation.split('.').filter(f => f.trim());
        factors.forEach(factor => riskFactors.add(factor.trim()));
      }
    });
    
    let html = `<div style="margin-bottom: 1rem;">
      <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
        <span>Overall Fraud Rate:</span>
        <span style="color: ${fraudulentCount > 0 ? 'var(--error)' : 'var(--success)'}; font-weight: 600;">${fraudRate}%</span>
      </div>
      <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
        <span>Risk Level:</span>
        <span style="color: ${fraudRate > 10 ? 'var(--error)' : fraudRate > 5 ? 'var(--warning)' : 'var(--success)'}; font-weight: 600;">
          ${fraudRate > 10 ? 'üî¥ High' : fraudRate > 5 ? 'üü° Medium' : 'üü¢ Low'}
        </span>
      </div>
    </div>`;
    
    if (riskFactors.size > 0) {
      html += `<div style="margin-bottom: 1rem;">
        <h4 style="margin-bottom: 0.5rem; color: var(--primary);">üîç Detected Risk Factors:</h4>
        <ul style="margin-left: 1rem; color: var(--text-secondary);">`;
      
      Array.from(riskFactors).slice(0, 5).forEach(factor => {
        html += `<li style="margin-bottom: 0.25rem;">${factor}</li>`;
      });
      
      html += `</ul></div>`;
    }
    
    html += `<p style="color: var(--text-secondary); font-size: 0.9rem;">
      Advanced fraud detection algorithms analyzed ${totalCount} transactions using machine learning patterns including amount analysis, location verification, device authentication, and temporal behavior patterns.
    </p>`;
    
    explanationBox.innerHTML = html;
  },

  async checkBackendHealth() {
    try {
      const response = await fetch(`${this.apiBaseUrl}/health`);
      if (response.ok) {
        console.log('Backend API is healthy');
      } else {
        console.warn('Backend API health check failed');
      }
    } catch (error) {
      console.warn('Backend API not available:', error.message);
    }
  },

  downloadTemplate() {
    // Create sample CSV content
    const csvContent = `user_id,amount,location,device,merchant,timestamp
user_1,1500.50,Mumbai,android,Cafe,2024-01-15 14:30:00
user_2,2500.75,Delhi,ios,Grocery,2024-01-15 15:45:00
user_3,800.25,Bangalore,web,Electronics,2024-01-15 16:20:00
user_1,3200.00,Mumbai,android,Online Store,2024-01-15 17:10:00
user_2,450.80,Delhi,ios,Cafe,2024-01-15 18:30:00`;

    // Create and download file
    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'transaction_template.csv';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
  }
};

// Authentication Functions
function handleLogin(event) {
  event.preventDefault();
  
  const form = document.querySelector('.login-container');
  const loginBtn = document.getElementById('login-text');
  const loadingSpinner = document.getElementById('login-loading');
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value;

  // Show loading state
  loginBtn.style.display = 'none';
  loadingSpinner.style.display = 'block';

  // Simulate API call delay
  setTimeout(() => {
    const validCredentials = username === 'user123' && password === 'pass123';
    
    if (validCredentials) {
      localStorage.setItem('isLoggedIn', 'true');
      localStorage.setItem('username', username);
      app.currentUser = username;
      app.showDashboard();
    } else {
      // Reset button state
      loginBtn.style.display = 'block';
      loadingSpinner.style.display = 'none';
      
      // Show error
      form.classList.add('shake');
      setTimeout(() => form.classList.remove('shake'), 500);
      
      // Focus on username field
      document.getElementById('username').focus();
      document.getElementById('username').select();
    }
  }, 1000);
}

function handleLogout() {
  if (confirm('Are you sure you want to sign out?')) {
    localStorage.removeItem('isLoggedIn');
    localStorage.removeItem('username');
    app.currentUser = null;
    app.isLoggedIn = false;
    app.showLogin();
  }
}

function toggleSidebar() {
  const sidebar = document.getElementById('sidebar');
  if (window.innerWidth <= 768) {
    sidebar.classList.toggle('collapsed');
  }
}

// Initialize app when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
  app.init();
});

  </script>
</body>
</html>